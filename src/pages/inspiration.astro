---
import Layout from "../layouts/Layout.astro";
import Section from "../components/ui/Section.astro";
import { Image } from "astro:assets";

// Import all project images (WebP format only)
const allImages = import.meta.glob<{ default: ImageMetadata }>(
    "../assets/images/projects/**/*.webp",
    { eager: true },
);

// Convert to array and shuffle
// Convert to array with slug extraction
const images = Object.entries(allImages).map(([path, module]) => {
  const parts = path.split("/");
  // Assuming path structure: ../assets/images/projects/[slug]/[filename]
  // 'projects' index in ["..", "assets", "images", "projects", "slug", "filename"] is 3
  const projectsIndex = parts.indexOf("projects");
  const folderName = parts[projectsIndex + 1];

  // Map folder names to route slugs
  const folderToSlug: Record<string, string> = {
    "beach-house-malaga": "malaga",
    "country-estate-antwerpen": "antwerpen",
    "duplex-penthouse-barcelona": "barcelona",
    "penthouse-dubai-marina": "dubai-marina",
    "villa-mansion-netherlands": "netherlands",
  };

  const slug = folderToSlug[folderName] || folderName; // Fallback to folder name if no map found
  
  const title = slug.split('-').map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' ');
  
  return {
    image: module.default,
    slug: slug,
    title: title
  };
});

// Fisher-Yates shuffle
function shuffleArray(array: { image: ImageMetadata; slug: string; title: string }[]) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

const shuffledImages = shuffleArray([...images]);
---

<Layout title="Inspiration | By Shakir">
    <Section variant="black" class="min-h-screen pt-32 pb-24" animate={false}>
        <div class="mb-16 md:mb-24 px-4 md:px-0 reveal">
            <h1 class="text-5xl md:text-7xl font-heading text-brand-text mb-8">
                Visual <span class="text-brand-gold italic">Inspiration</span>
            </h1>
            <p class="text-brand-text/60 max-w-xl text-lg">
                A curated collection of textures, moods, and moments. <br />
                The raw elements that define our metropolitan luxury aesthetic.
            </p>
        </div>

        <!-- Masonry Grid Gallery -->
        <div class="columns-1 md:columns-2 lg:columns-3 gap-8 space-y-8 px-4 md:px-0">
            {
                shuffledImages.slice(0, 30).map((item, index) => (
                    <a
                        href={`/projects/${item.slug}`}
                        class="block relative group overflow-hidden bg-brand-dark cursor-pointer mb-8 break-inside-avoid reveal"
                    >
                        <Image
                            src={item.image}
                            alt={`${item.title} luxury interior design inspiration`}
                            width={800} 
                            height={1000} 
                            loading={index < 3 ? "eager" : "lazy"}
                            decoding="async"
                            class="w-full h-auto object-cover transform-gpu transition-transform duration-[1.5s] ease-out group-hover:scale-105"
                        />
                        
                        <!-- Project Title Overlay - Minimalist -->
                        <div class="absolute inset-0 z-20 p-6 flex flex-col justify-end opacity-0 group-hover:opacity-100 transition-opacity duration-500 bg-black/40">
                            <div class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">
                                <h3 class="text-xl md:text-2xl font-heading text-white font-medium">
                                    {item.title}
                                </h3>
                                <p class="text-brand-gold text-[10px] font-bold uppercase tracking-[0.2em] mt-3">
                                    Explore Space
                                </p>
                            </div>
                        </div>
                    </a>
                ))
            }
        </div>
    </Section>
</Layout>
